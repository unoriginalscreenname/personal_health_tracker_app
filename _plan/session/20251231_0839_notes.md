# Session Notes - 2025-12-31 08:39

Fixed streak counting bug where missing days weren't being created, causing confusing streak display.

## What Was Done

### Fixed Gap-Filling Logic in `initializeDay()`
- **Problem:** User had Sunday (Dec 28) and Tuesday (Dec 30) logged, but Monday (Dec 29) was missing from stats history. Streak showed 0 even though user completed their goals on logged days.
- **Root Cause:** `initializeDay()` started gap-filling from the **most recent** row and looked forward. But when user logs data directly (e.g., food on Dec 30), `updateStatsForDate()` creates that row without gap-filling. The gap (Dec 29) was BEFORE the most recent row, so it was never filled.
- **Fix:** Changed to start from the **oldest** row and fill ALL gaps forward to yesterday.

### Fixed Timezone Bug in Streak Calculation
- **Problem:** After gap-fill worked, streak still showed 0.
- **Root Cause:** `new Date("2024-12-30")` parses as UTC midnight. When converted back to local time via `formatDateLocal()`, it can shift to the previous day (Dec 29 in PST).
- **Fix:** Added `T12:00:00` suffix when parsing date strings: `new Date(yesterday + 'T12:00:00')`. Parsing as local noon avoids timezone day-shift.

## Files Modified

- `db/hooks/useDailyStats.ts`
  - `initializeDay()`: Start from oldest row, fill all gaps forward
  - `getStreak()`: Add `T12:00:00` to date parsing
  - `getCombinedStreak()`: Add `T12:00:00` to date parsing

## Key Patterns Learned

### Date String Parsing in JavaScript
```typescript
// BAD - parses as UTC midnight, can shift day in local timezone
const date = new Date("2024-12-30");

// GOOD - parses as local noon, stays on correct day
const date = new Date("2024-12-30T12:00:00");
```

### Gap-Filling Strategy
When filling missing days in a date sequence:
- Start from the **oldest** record, not the most recent
- Fill forward to yesterday
- This catches gaps anywhere in the history, not just at the end

## Commits This Session
- None yet (uncommitted changes)

## Notes
- The codebase already used `T12:00:00` pattern in `stats/index.tsx` for `formatDateDisplay()`, but it wasn't applied consistently in streak calculations
- Added this pattern to `_plan/react-native-best-practices.md` for future reference
