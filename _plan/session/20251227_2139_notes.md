# Session Notes - Dec 27, 2025 (Late Night)

## Summary

Implemented daily stats tracking and streak calculation system with day rollover logic.

## What Was Done

### Database Schema
- Added `daily_stats` table with `fasting_compliant`, `supplements_complete`, `finalized` columns
- Bumped DATABASE_VERSION to 2
- Added v1->v2 migration in database.tsx

### New Hook: useDailyStats
- `initializeDay()` - handles first day, day rollover, backfilling gaps
- `updateTodayStats()` - recalculates in-progress stats
- `getStreak()` - counts consecutive finalized successes
- `getStatsForRange()` - for calendar view (future)

### Hook Integration
- useMealEntries now calls `updateTodayStats()` after data changes
- useSupplements now calls `updateTodayStats()` after data changes

### Command Center Updates
- Added "Today is X" date label above streak banner
- Streak now pulls from `getStreak('supplements_complete')`
- Day count calculated from `daily_stats` row count

### Success Criteria Defined
- Fasting: all meals between 12:00-18:00
- Supplements: all at target, water needs 2/4 minimum

## Files Changed

- `db/schema.ts` - added daily_stats table, v2 migration SQL
- `db/database.tsx` - added v1->v2 migration logic
- `db/hooks/useDailyStats.ts` - new file
- `db/hooks/useMealEntries.ts` - added updateTodayStats calls
- `db/hooks/useSupplements.ts` - added updateTodayStats calls
- `db/index.ts` - export useDailyStats
- `app/(tabs)/index.tsx` - date label, real streak/day values
- `_plan/db/daily-stats-streaks.md` - updated planning doc

## Commits

- `b75851f` - Implement daily stats tracking

## Notes

- Migration requires full app restart (not hot reload) to trigger onInit
- First day edge case: if no rows exist, just create today's row, don't backfill
- Streaks only count finalized days (yesterday and before)
- Today is always in-progress, doesn't count toward streak
