# Session Notes - 2025-12-28 04:34

Fixed timezone bugs in date handling and added stats history feature with day detail view.

## What Was Done

### Timezone Bug Fixes
- Fixed `getToday()` and `getYesterday()` functions across all hooks to use local timezone instead of UTC
- Added `formatDateLocal()` helper function to `useDailyStats`, `useSupplements`, `useMealEntries`
- Fixed fasting compliance SQL query to use `strftime('%H', logged_at, 'localtime')` instead of UTC

### Stats History Feature
- Created `/stats` route with stack navigation (hidden from tab bar)
- `stats/index.tsx` - Lists all days with stats, shows fasting/supplements indicators
- `stats/[date].tsx` - Day detail view with:
  - Clickable date header with date picker modal
  - Prev/next day navigation arrows
  - "Change to Date" button to move all data to a different date
  - Protein stats and food timeline
  - Supplements section with toggle functionality
  - Section headers showing success/failure indicators for fasting window and supplements

### Database Functions
- Added `hasDataForDate(date)` - checks if any data exists for a date
- Added `moveDateData(fromDate, toDate)` - moves all meal entries, supplement logs, and daily stats
- Added `updateStatsForDate(date)` - recalculates stats for any date (finalized or not)
- Updated all supplement and meal entry hooks to call `updateStatsForDate(date)` instead of `updateTodayStats()`

### UI Updates
- Made streak banner on Command Center clickable to navigate to stats
- Added "FASTING WINDOW" section header with success/failure indicator
- Updated "SUPPLEMENTS" section header with success/failure indicator

## Commits
- 4252c93 - Enhance tab navigation, stats screen, local timezone formatting

## Notes
- The `finalized` flag in daily_stats no longer prevents recalculation - stats update automatically on any data change
- Fasting compliance requires all meals between 12 PM - 6 PM local time; no meals = failure
- Supplements completion requires all at target except water (only needs 2/4)
