# Session Notes - 2025-12-28 12:52

Fixed critical data refresh bugs and extracted FoodTimeline component.

## What Was Done

### FoodTimeline Component Extraction
- Created `components/app/FoodTimeline.tsx` - self-contained with `date` prop
- Removed inline timeline code from `nutrition/index.tsx` and `stats/[date].tsx`
- Follows same pattern as other self-contained components

### Fixed `useFocusEffect` vs `useEffect` Bug (IMPORTANT)
- **Problem:** Components using `useEffect` don't reload data when navigating back (screens stay mounted in stack)
- **Fixed components:**
  - `FoodTimeline.tsx`
  - `NutritionCard.tsx`
  - `SupplementsCard.tsx`
  - `FastingCard.tsx`
- **Added to best practices doc:** `_plan/react-native-best-practices.md`

### Fixed Tab Navigation Stack Reset
- **Problem:** Clicking Fuel tab showed last screen in stack (stuck on deleted entry showing "Loading...")
- **Fix:** Added `tabPress` listener to nutrition tab in `app/(tabs)/_layout.tsx` that calls `router.replace('/nutrition')`

### Fixed Section Header Not Updating
- **Problem:** On `[date].tsx`, supplement section header didn't turn green when all supplements completed
- **Fix:** Added `onUpdate` callback prop to `SupplementsCard` - parent passes `loadData` to refresh stats

### Fixed Streak Banner Not Updating
- **Problem:** On command page, streak didn't update when supplements toggled
- **Fix:** Extracted `loadData` in `index.tsx` and passed as `onUpdate` to `SupplementsCard`

### UI Tweak
- Changed "2 added >" to "2 added âœ“" on log food page, made it clickable to go back

## Commits
- 36b48a2 - Main commit with all fixes

## Key Pattern: `onUpdate` Callback

When a self-contained component modifies data that affects parent UI:
```tsx
// In component
interface Props {
  date: string;
  onUpdate?: () => void;  // Optional callback
}

// After modifying data:
onUpdate?.();

// In parent
<SupplementsCard date={today} onUpdate={loadData} />
```

## Gotchas Learned
1. `useEffect` only runs on mount - use `useFocusEffect` for data that needs refresh on navigation
2. Tab navigation doesn't reset stack by default - need custom `tabPress` listener
3. Self-contained components need `onUpdate` callback when parent cares about their data changes
