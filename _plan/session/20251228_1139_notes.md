# Session Notes - 2025-12-28 11:39

Major refactor: Self-contained components with `date` prop architecture.

## Key Architectural Decision

**Components should be SELF-CONTAINED.** They take a `date` prop and handle ALL their own:
- Database queries
- State management
- Callbacks

The page just drops in `<ComponentName date={currentDate} />` and the component does everything internally.

## What Was Refactored

### SupplementsCard (`components/app/SupplementsCard.tsx`)
- Takes `date` prop only
- Internally uses `useSupplements()` hook
- Handles `toggleSupplement`, `setSupplementValue` callbacks internally
- Loads and manages its own `supplements` state

### NutritionCard (`components/app/NutritionCard.tsx`)
- Takes `date` prop and optional `variant` and `onPress`
- **Two variants:**
  - `variant="compact"` - half-width card with centered content, Target icon, for command center row layout
  - `variant="full"` (default) - no background/padding, just protein stats + progress bar
- Internally uses `useMealEntries().getTotalsForDate()`
- Loads and manages its own `totals` state

### FastingCard (`components/app/FastingCard.tsx`)
- Takes `date` prop only
- Internally determines if date is today
- **If today:** Shows live timer using `useFastingState()` hook
- **If past date:** Shows historical compliance status from `daily_stats`

## Usage Examples

**Command Center (`app/(tabs)/index.tsx`):**
```tsx
<FastingCard date={today} />

<View style={styles.row}>
  <SittingModeCard ... />
  <NutritionCard date={today} variant="compact" onPress={() => router.navigate('/nutrition')} />
</View>

<SupplementsCard date={today} />
```

**Day Detail (`app/(tabs)/stats/[date].tsx`):**
```tsx
<NutritionCard date={currentDate} />
<SupplementsCard date={currentDate} />
```

## Component Architecture Rules

1. **Self-contained:** Component handles its own data fetching and state
2. **Date-driven:** Pass `date` prop, component figures out everything else
3. **Variants for layout:** Use `variant` prop when same component needs different layouts (e.g., compact vs full)
4. **No prop drilling:** Don't pass callbacks or data arrays - component owns its logic

## What NOT to Do

❌ Don't pass data arrays and callbacks:
```tsx
// WRONG - page manages everything
<SupplementsCard
  pillSupplements={pillSupplements}
  waterSupplement={waterSupplement}
  onSupplementPress={handleSupplementPress}
  onWaterDotPress={handleWaterDotPress}
/>
```

✅ Just pass the date:
```tsx
// RIGHT - component is self-contained
<SupplementsCard date={currentDate} />
```

## Files Modified

- `components/app/SupplementsCard.tsx` - self-contained with date prop
- `components/app/NutritionCard.tsx` - self-contained with date + variant props
- `components/app/FastingCard.tsx` - self-contained with date prop (live vs historical)
- `app/(tabs)/index.tsx` - simplified, just passes date to components
- `app/(tabs)/stats/[date].tsx` - simplified, uses NutritionCard and SupplementsCard

## Agent Protocol Updated

`_plan/agents/component-extraction-agent.md` - general protocol for extracting components

## Notes for Next Session

- SittingModeCard and WorkoutCard still use old pattern (props for data) - could be refactored
- StreakBanner still needs page-level data - could potentially be self-contained too
- When adding new components, follow self-contained pattern with `date` prop
